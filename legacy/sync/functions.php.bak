<?php # sync/functions.php

function sanitize($input) {
    $input = strip_tags($input);
    $input = str_replace(["\n", "\r"], '', $input);
    $input = preg_replace('/[^a-zA-Z0-9 _:\-\.]/', '', $input);
    return $input;
}

function logMessage($message, $isError = false) {
    $timestamp = date('Y-m-d H:i:s');
    $safeMessage = sanitize($message);

    $logFile = defined('SYNC_LOG_FILE') ? SYNC_LOG_FILE : __DIR__ . '/log/fetch_sync.log';
    $errorFile = defined('SYNC_ERROR_FILE') ? SYNC_ERROR_FILE : __DIR__ . '/log/fetch_sync_errors.log';

    file_put_contents($logFile, "[$timestamp] $safeMessage\n", FILE_APPEND);
    if ($isError) {
        file_put_contents($errorFile, "[$timestamp] $safeMessage\n", FILE_APPEND);
    }
}
